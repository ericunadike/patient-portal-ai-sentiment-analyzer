<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Patient services portal for Magodo Specialist Hospital, including feedback and registration forms.">
    <meta name="keywords" content="hospital, patient services, feedback, registration, Magodo Specialist Hospital">
    <meta name="author" content="Magodo Specialist Hospital">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-SN9W0VL22Y"></script>
    <script>
        window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date());gtag('config','G-SN9W0VL22Y');
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <script>
        (function(){emailjs.init("Z0VMFmiXu1u4xRa9b")})();
    </script>
    <title>Patient Services - Magodo Specialist Hospital</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,sans-serif;background:#f5f6f5;min-height:100vh;padding:4px;display:flex;align-items:center;justify-content:center;line-height:1.6;position:relative;overflow-x:hidden}body::before{content:'üè• ‚ù§Ô∏è üòä üíö üåü ‚ú® üí´ üéâ';position:fixed;top:-50px;left:-100%;font-size:24px;animation:float 25s linear infinite;opacity:.1;z-index:0;white-space:nowrap}@keyframes float{0%{transform:translateX(0) rotate(0deg)}100%{transform:translateX(200vw) rotate(360deg)}}.main-container{background:rgba(255,255,255,0.98);backdrop-filter:blur(20px);border-radius:32px;padding:16px;max-width:420px;width:100%;box-shadow:0 20px 60px rgba(255,255,255,0.3),0 10px 30px rgba(255,255,255,0.15),inset 0 1px 0 rgba(255,255,255,0.9);border:3px solid rgba(255,255,255,0.2);animation:bounceIn 1s cubic-bezier(0.68,-0.55,0.265,1.55);position:relative;z-index:1}@keyframes bounceIn{0%{opacity:0;transform:translateY(60px) scale(0.3) rotate(-10deg)}50%{opacity:.8;transform:translateY(-20px) scale(1.05) rotate(2deg)}70%{opacity:.9;transform:translateY(10px) scale(0.98) rotate(-1deg)}100%{opacity:1;transform:translateY(0) scale(1) rotate(0deg)}}.hospital-header{text-align:center;margin-bottom:20px}.hospital-icon{width:70px;height:70px;background:transparent url('MSH LOGO.png') no-repeat center center;background-size:contain;border-radius:50%;margin:0 auto 12px;box-shadow:0 8px 30px rgba(0,0,0,0.1),0 0 0 8px rgba(0,0,0,0.05);animation:pulse 2s infinite}@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}.hospital-header h1{color:#000080;font-size:20px;font-weight:800;margin-bottom:6px;letter-spacing:-.5px}.hospital-header p{color:#57CAC3;font-size:14px;font-weight:600}.tab-navigation{display:flex;margin-bottom:20px;border-radius:20px;background:rgba(152,251,152,0.1);padding:6px;box-shadow:inset 0 2px 8px rgba(152,251,152,0.15);position:relative}.tab-indicator{position:absolute;background:#27ae60;border-radius:16px;transition:transform .6s cubic-bezier(0.4,0,0.2,1);box-shadow:0 4px 20px rgba(152,251,152,0.4);width:calc(50% - 12px);height:calc(100% - 12px);left:6px;top:6px}.tab-btn{flex:1;background:none;border:none;padding:16px 20px;text-align:center;font-size:14px;font-weight:700;color:#636e72;cursor:pointer;border-radius:16px;display:flex;align-items:center;justify-content:center;gap:8px;text-transform:uppercase;letter-spacing:.5px}.tab-btn.active{color:white;text-shadow:0 1px 3px rgba(0,0,0,0.3);transform:translateY(-1px)}.tab-btn:hover:not(.active){color:#27ae60;transform:translateY(-2px) scale(1.02)}.tab-icon{font-size:18px}.tab-content{display:none;animation:slideInUp .8s cubic-bezier(0.4,0,0.2,1)}.tab-content.active{display:block}@keyframes slideInUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}.form-group{margin-bottom:16px}.form-row{display:grid;grid-template-columns:1fr;gap:12px}.form-group label{display:block;margin-bottom:8px;color:#2d3436;font-weight:700;font-size:15px}.required::after{content:'*';color:#e17055;margin-left:4px;font-size:16px;font-weight:800}.form-input{width:100%;padding:16px 18px;border:3px solid #e9ecef;border-radius:16px;font-family:inherit;font-size:16px;font-weight:500;background:rgba(255,255,255,0.9);backdrop-filter:blur(10px)}:focus{outline:none;border-color:#27ae60;background:white}.form-input::placeholder,.comment-input::placeholder,.comment-textarea::placeholder{color:#a0a0a0;font-weight:500;font-size:14px}.form-input.error{border-color:#e17055}.error-message{color:#e17055;font-size:13px;font-weight:600;margin-top:6px;display:none}.form-input.error+.error-message{display:block}.form-select{width:100%;padding:16px 36px 16px 18px;border:3px solid #e9ecef;border-radius:16px;font-family:inherit;font-size:16px;font-weight:500;background:rgba(255,255,255,0.9) url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="%23636e72"><path d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/></svg>') no-repeat right 12px center;background-size:20px;color:#2d3436;cursor:pointer;appearance:none}.form-select:focus,.form-select:hover{border-color:#27ae60;background-color:white}.form-select option{background:white;color:#2d3436}.checkbox-group{display:flex;align-items:flex-start;gap:16px;margin-top:16px;padding:16px;border-radius:16px;border:2px solid transparent}.checkbox-group:hover{background:rgba(152,251,152,0.08);border-color:rgba(152,251,152,0.2)}.custom-checkbox{width:28px;height:28px;border:3px solid #e9ecef;border-radius:10px;display:flex;align-items:center;justify-content:center;cursor:pointer}.custom-checkbox.checked{background:#27ae60;border-color:#27ae60}.custom-checkbox.checked::after{content:'‚úì';color:white;font-size:16px;font-weight:700}.checkbox-label{color:#636e72;font-size:15px;font-weight:500;cursor:pointer;line-height:1.5}.payment-info{background:rgba(152,251,152,0.1);border:3px solid rgba(152,251,152,0.2);border-radius:20px;padding:20px;margin-top:16px;display:none}.payment-info.show{display:block}.payment-info h4{color:#27ae60;font-size:16px;font-weight:800;margin-bottom:12px}.payment-info p{color:#636e72;font-size:15px;font-weight:500}.price-highlight{color:#27ae60;font-weight:800;background:rgba(152,251,152,0.15);padding:4px 8px;border-radius:8px}.question-section{margin-bottom:20px;padding:16px;background:rgba(152,251,152,0.03);border-radius:20px;border:2px solid rgba(152,251,152,0.1)}.question-title{color:#2d3436;margin-bottom:16px;font-size:17px;font-weight:800;text-align:center}.rating-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:6px;margin:0 -8px 12px}.rating-option{border:3px solid #e9ecef;border-radius:16px;background:white;cursor:pointer;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:8px 4px;min-height:70px}.rating-option:hover{transform:translateY(-3px);box-shadow:0 8px 25px rgba(152,251,152,0.25);border-color:#27ae60}.rating-option.selected{border-color:#27ae60;border-width:4px}.rating-emoji{font-size:22px;margin-bottom:4px}.rating-option.selected .rating-emoji{transform:scale(1.1)}.rating-label{font-size:11px;color:#636e72;font-weight:700;text-align:center;text-transform:uppercase}.rating-option.selected .rating-label{color:#27ae60;font-weight:800}.rating-scale{display:flex;justify-content:space-between;margin-top:12px;font-size:12px;color:#a0a0a0;font-weight:600}.comment-section{margin-bottom:20px}.comment-input,.comment-textarea{width:100%;padding:16px 18px;border:3px solid #e9ecef;border-radius:16px;font-family:inherit;font-size:16px;font-weight:500;background:white}.comment-textarea{resize:vertical;min-height:100px;margin-bottom:16px}.submit-section{text-align:center;margin-top:24px}.submit-btn{width:100%;padding:18px 24px;background:#27ae60;color:white;border:none;border-radius:20px;font-size:16px;font-weight:800;cursor:pointer;text-transform:uppercase;letter-spacing:1px;box-shadow:0 8px 30px rgba(152,251,152,0.4)}.submit-btn:hover:not(:disabled){transform:translateY(-4px);box-shadow:0 15px 40px rgba(152,251,152,0.5)}.submit-btn:disabled{background:#ddd;cursor:not-allowed;box-shadow:none}.thank-you,.registration-success{display:none;text-align:center;padding:32px 16px}.success-icon,.success-animation{width:80px;height:80px;border-radius:50%;background:#27ae60;margin:0 auto 20px;display:flex;align-items:center;justify-content:center;box-shadow:0 10px 40px rgba(152,251,152,0.4)}.thank-you h2,.registration-success h2{color:#27ae60;margin-bottom:16px;font-size:24px;font-weight:800}.thank-you p,.registration-success p{color:#636e72;font-size:15px;font-weight:500;max-width:320px;margin:0 auto}.voice-btn{background:#27ae60;color:white;border:none;border-radius:12px;padding:10px 16px;font-size:14px;font-weight:600;cursor:pointer;display:inline-flex;align-items:center;gap:8px;margin-top:8px}.voice-btn:hover{transform:translateY(-2px);box-shadow:0 5px 15px rgba(152,251,152,0.5)}.voice-btn.active{background:#e17055}.voice-btn:disabled{background:#ddd;cursor:not-allowed}@media (max-width:480px){.main-container{padding:12px;border-radius:24px;max-width:calc(100vw - 4px)}.hospital-header h1{font-size:18px}.hospital-icon{width:60px;height:60px}.tab-btn{padding:12px 6px;font-size:11px}.tab-icon{font-size:16px}.form-row{gap:10px}.question-title{font-size:15px}.rating-grid{gap:4px;margin:0 -4px 10px}.rating-option{padding:6px 4px;min-height:60px}.rating-emoji{font-size:22px}.rating-label{font-size:8px}.comment-textarea,.comment-input{padding:14px;font-size:16px}.submit-btn{padding:16px 20px;font-size:14px}.payment-info{padding:14px}.question-section{padding:12px}.success-icon,.success-animation{width:70px;height:70px}.thank-you h2,.registration-success h2{font-size:20px}.form-input,.form-select{font-size:16px;padding:14px 32px 14px 16px}.form-select{background-position:right 10px center;background-size:18px}.rating-scale{font-size:10px}.form-group label{font-size:14px}.checkbox-label{font-size:14px}.payment-info p{font-size:14px}.voice-btn{font-size:12px;padding:8px 12px}}.visually-hidden{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}
    </style>
</head>
<body>
    <div class="main-container">
        <div class="hospital-header">
            <div class="hospital-icon" role="img" aria-label="Hospital logo"></div>
            <h1>Magodo Specialist Hospital</h1>
            <p>You are amazing!</p>
        </div>

        <div class="tab-navigation" role="tablist">
            <div class="tab-indicator" id="tabIndicator"></div>
            <button class="tab-btn active" data-tab="feedback" role="tab" aria-selected="true" aria-controls="feedbackTab">
                <span class="tab-icon">üí¨</span> Feedback
            </button>
            <button class="tab-btn" data-tab="registration" role="tab" aria-selected="false" aria-controls="registrationTab">
                <span class="tab-icon">üë§</span> Register
            </button>
        </div>

        <div class="tab-content active" id="feedbackTab" role="tabpanel">
            <div class="survey-form" id="surveyForm">
                <div class="question-section">
                    <h3 class="question-title" id="satisfactionTitle">How satisfied are you with our care?</h3>
                    <div class="rating-grid" id="satisfactionRating" role="radiogroup" aria-labelledby="satisfactionTitle">
                        <button type="button" class="rating-option" data-value="1" role="radio" aria-checked="false">
                            <span class="rating-emoji">üòû</span>
                            <span class="rating-label">Very Poor</span>
                        </button>
                        <button type="button" class="rating-option" data-value="2" role="radio" aria-checked="false">
                            <span class="rating-emoji">üòï</span>
                            <span class="rating-label">Poor</span>
                        </button>
                        <button type="button" class="rating-option" data-value="3" role="radio" aria-checked="false">
                            <span class="rating-emoji">üòê</span>
                            <span class="rating-label">Fair</span>
                        </button>
                        <button type="button" class="rating-option" data-value="4" role="radio" aria-checked="false">
                            <span class="rating-emoji">üòä</span>
                            <span class="rating-label">Good</span>
                        </button>
                        <button type="button" class="rating-option" data-value="5" role="radio" aria-checked="false">
                            <span class="rating-emoji">ü§©</span>
                            <span class="rating-label">Excellent</span>
                        </button>
                    </div>
                    <div class="rating-scale">
                        <span>Not satisfied</span>
                        <span>Very satisfied</span>
                    </div>
                </div>

                <div class="question-section">
                    <h3 class="question-title" id="recommendTitle">Would you recommend us?</h3>
                    <div class="rating-grid" id="recommendRating" role="radiogroup" aria-labelledby="recommendTitle">
                        <button type="button" class="rating-option" data-value="1" role="radio" aria-checked="false">
                            <span class="rating-emoji">üëé</span>
                            <span class="rating-label">Never</span>
                        </button>
                        <button type="button" class="rating-option" data-value="2" role="radio" aria-checked="false">
                            <span class="rating-emoji">ü§∑</span>
                            <span class="rating-label">Unlikely</span>
                        </button>
                        <button type="button" class="rating-option" data-value="3" role="radio" aria-checked="false">
                            <span class="rating-emoji">ü§î</span>
                            <span class="rating-label">Maybe</span>
                        </button>
                        <button type="button" class="rating-option" data-value="4" role="radio" aria-checked="false">
                            <span class="rating-emoji">üëç</span>
                            <span class="rating-label">Likely</span>
                        </button>
                        <button type="button" class="rating-option" data-value="5" role="radio" aria-checked="false">
                            <span class="rating-emoji">üíØ</span>
                            <span class="rating-label">Definitely</span>
                        </button>
                    </div>
                    <div class="rating-scale">
                        <span>Would not recommend</span>
                        <span>Highly recommend</span>
                    </div>
                </div>

                <div class="comment-section">
                    <label for="patientName">Your Name (Optional)</label>
                    <input type="text" id="patientName" class="comment-input" placeholder="What should we call you?" aria-describedby="patientNameDesc">
                    <p id="patientNameDesc" class="visually-hidden">Providing your name is optional and helps us personalize our response.</p>
                </div>

                <div class="comment-section">
                    <label for="patientContact">Email or Phone (Optional)</label>
                    <input type="text" id="patientContact" class="comment-input" placeholder="email@example.com or +234 801 234 5678" aria-describedby="patientContactDesc patientContactError">
                    <p id="patientContactDesc" class="visually-hidden">Providing contact information is optional and allows us to follow up if needed.</p>
                    <div class="error-message" id="patientContactError">Please enter a valid email or phone number</div>
                </div>

                <div class="comment-section">
                    <label for="comments">Share your experience!</label>
                    <textarea id="comments" class="comment-textarea" placeholder="Tell us about your visit - we love hearing from you!" rows="4" aria-describedby="commentsDesc"></textarea>
                    <p id="commentsDesc" class="visually-hidden">Share your feedback about your experience at Magodo Specialist Hospital.</p>
                    <button type="button" class="voice-btn" id="voiceInput" aria-label="Start voice input" disabled>
                        <span class="voice-icon">üé§</span> Voice Input
                    </button>
                </div>

                <div class="submit-section">
                    <button type="button" class="submit-btn" id="submitBtn" disabled>Send Feedback üöÄ</button>
                </div>
            </div>

            <div class="thank-you" id="thankYou">
                <div class="success-icon" role="img" aria-label="Success icon"></div>
                <h2>Amazing! Thank You! üéâ</h2>
                <p>Your feedback means the world to us! We're constantly working to make your healthcare experience even better. You rock! üí™</p>
            </div>
        </div>

        <div class="tab-content" id="registrationTab" role="tabpanel">
            <form id="registrationForm" novalidate>
                <div class="form-row">
                    <div class="form-group">
                        <label for="lastName" class="required">Last Name</label>
                        <input type="text" id="lastName" class="form-input" placeholder="Your family name" required aria-describedby="lastNameError">
                        <div class="error-message" id="lastNameError">Please enter your last name</div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="firstName" class="required">First Name</label>
                        <input type="text" id="firstName" class="form-input" placeholder="Your first name" required aria-describedby="firstNameError">
                        <div class="error-message" id="firstNameError">Please enter your first name</div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="middleName">Middle Name</label>
                        <input type="text" id="middleName" class="form-input" placeholder="Your middle name (optional)" aria-describedby="middleNameDesc">
                        <p id="middleNameDesc" class="visually-hidden">Middle name is optional.</p>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="maritalStatus" class="required">Marital Status</label>
                        <select id="maritalStatus" class="form-select" required aria-describedby="maritalStatusError">
                            <option value="" disabled selected>Select marital status</option>
                            <option value="single">Single</option>
                            <option value="married">Married</option>
                            <option value="divorced">Divorced</option>
                            <option value="widowed">Widowed</option>
                            <option value="separated">Separated</option>
                        </select>
                        <div class="error-message" id="maritalStatusError">Please select your marital status</div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="phone" class="required">Phone Number</label>
                        <input type="tel" id="phone" class="form-input" placeholder="e.g. +234 801 234 5678" required aria-describedby="phoneError">
                        <div class="error-message" id="phoneError">Please enter a valid phone number</div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" id="email" class="form-input" placeholder="e.g. email@example.com" aria-describedby="emailError emailDesc">
                        <div class="error-message" id="emailError">Please enter a valid email address</div>
                        <p id="emailDesc" class="visually-hidden">Email address is optional.</p>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="dateOfBirth" class="required">Date of Birth</label>
                        <input type="date" id="dateOfBirth" class="form-input" required aria-describedby="dateOfBirthError">
                        <div class="error-message" id="dateOfBirthError">Please select your date of birth</div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="gender" class="required">Gender</label>
                        <select id="gender" class="form-select" required aria-describedby="genderError">
                            <option value="" disabled selected>Select gender</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="other">Other</option>
                        </select>
                        <div class="error-message" id="genderError">Please select your gender</div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="payor" class="required">Payor Type</label>
                        <select id="payor" class="form-select" required aria-describedby="payorError">
                            <option value="" disabled selected>Select payor type</option>
                            <option value="personal">Personal - ‚Ç¶7,500</option>
                            <option value="family">Family - ‚Ç¶15,000</option>
                            <option value="aiico">AIICO</option>
                            <option value="anchor">Anchor</option>
                            <option value="axamansard">Axamansard</option>
                            <option value="bastion">Bastion</option>
                            <option value="clearline">Clearline</option>
                            <option value="hygeia">Hygeia</option>
                            <option value="leadway">Leadway</option>
                            <option value="nem">NEM</option>
                            <option value="phillips">Phillips</option>
                            <option value="reliance">Reliance</option>
                            <option value="tht">THT</option>
                        </select>
                        <div class="error-message" id="payorError">Please select a payor type</div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="hmoId">HMO ID Number</label>
                        <input type="text" id="hmoId" class="form-input" placeholder="Enter your HMO ID" disabled aria-describedby="hmoIdError hmoIdDesc">
                        <div class="error-message" id="hmoIdError">Please enter your HMO ID</div>
                        <p id="hmoIdDesc" class="visually-hidden">HMO ID is required only for HMO payor types.</p>
                    </div>
                </div>
                <div class="form-group">
                    <label for="address" class="required">Your Address</label>
                    <textarea id="address" class="comment-textarea" placeholder="Enter your full address..." rows="2" required aria-describedby="addressError"></textarea>
                    <div class="error-message" id="addressError">Please enter your address</div>
                </div>
                <div class="payment-info" id="paymentInfo">
                    <h4>üí≥ Payment Details</h4>
                    <p id="paymentText">Please make payment of <span class="price-highlight">‚Ç¶7,500</span> to complete your registration.</p>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="consent" class="visually-hidden" onchange="toggleConsent()">
                    <label for="consent" class="custom-checkbox" id="consentCheckbox" role="checkbox" aria-checked="false"></label>
                    <label for="consent" class="checkbox-label">I consent to the processing of my personal information for medical purposes and agree to the hospital's privacy policy.</label>
                </div>
                <div class="submit-section">
                    <button type="submit" class="submit-btn" id="registerBtn" disabled>Complete Registration üéØ</button>
                </div>
            </form>
            <div class="registration-success" id="registrationSuccess">
                <div class="success-animation" role="img" aria-label="Success animation"></div>
                <h2>Welcome to the Family! üéâ</h2>
                <p id="successMessage">Your registration is complete! We're excited to be part of your health journey. We'll be in touch soon! üíö</p>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            let currentTab = 'feedback';
            const tabButtons = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            const tabIndicator = document.getElementById('tabIndicator');
            const registrationForm = document.getElementById('registrationForm');
            const consentCheckbox = document.getElementById('consentCheckbox');
            const consentInput = document.getElementById('consent');
            const registerBtn = document.getElementById('registerBtn');
            const payorSelect = document.getElementById('payor');
            const hmoIdInput = document.getElementById('hmoId');
            const paymentInfo = document.getElementById('paymentInfo');
            const paymentText = document.getElementById('paymentText');
            let consentGiven = false;
            let satisfactionRating = null;
            let recommendRating = null;

            // Voice input setup
            const voiceInputBtn = document.getElementById('voiceInput');
            const commentsTextarea = document.getElementById('comments');
            let recognition;
            let isRecognizing = false;

            if ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window) {
                recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                recognition.lang = 'en-US';
                recognition.interimResults = true;
                recognition.continuous = true;

                recognition.onresult = (event) => {
                    let interimTranscript = '';
                    let finalTranscript = '';
                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        const transcript = event.results[i][0].transcript;
                        if (event.results[i].isFinal) {
                            finalTranscript += transcript + ' ';
                        } else {
                            interimTranscript += transcript;
                        }
                    }
                    commentsTextarea.value = finalTranscript + interimTranscript;
                    commentsTextarea.scrollTop = commentsTextarea.scrollHeight;
                    commentsTextarea.focus();
                };

                recognition.onstart = () => {
                    isRecognizing = true;
                    voiceInputBtn.classList.add('active');
                    voiceInputBtn.setAttribute('aria-label', 'Stop voice input');
                    voiceInputBtn.textContent = 'Stop Voice üé§';
                };

                recognition.onend = () => {
                    isRecognizing = false;
                    voiceInputBtn.classList.remove('active');
                    voiceInputBtn.setAttribute('aria-label', 'Start voice input');
                    voiceInputBtn.textContent = 'Voice Input üé§';
                };

                recognition.onerror = (event) => {
                    isRecognizing = false;
                    voiceInputBtn.classList.remove('active');
                    voiceInputBtn.setAttribute('aria-label', 'Start voice input');
                    voiceInputBtn.textContent = 'Voice Input üé§';
                    if (event.error === 'no-speech') {
                        alert('No speech detected. Please try again.');
                    } else if (event.error === 'not-allowed' || event.error === 'service-not-allowed') {
                        voiceInputBtn.disabled = true;
                        alert('Microphone access denied. Please enable microphone permissions.');
                    } else {
                        console.error('Speech recognition error:', event.error);
                    }
                };

                voiceInputBtn.disabled = false;
                voiceInputBtn.addEventListener('click', () => {
                    if (isRecognizing) {
                        recognition.stop();
                    } else {
                        try {
                            recognition.start();
                            if (navigator.vibrate) navigator.vibrate(50);
                        } catch (e) {
                            console.error('Error starting recognition:', e);
                            alert('Unable to start voice input. Please try again.');
                        }
                    }
                });
            } else {
                voiceInputBtn.style.display = 'none';
                console.warn('Speech recognition not supported in this browser.');
            }

            function switchTab(tabName) {
                tabButtons.forEach(btn => {
                    const isActive = btn.dataset.tab === tabName;
                    btn.classList.toggle('active', isActive);
                    btn.setAttribute('aria-selected', isActive);
                });
                tabContents.forEach(content => {
                    content.classList.toggle('active', content.id === `${tabName}Tab`);
                });
                const activeBtn = document.querySelector(`[data-tab="${tabName}"]`);
                const containerRect = activeBtn.parentElement.getBoundingClientRect();
                const btnRect = activeBtn.getBoundingClientRect();
                const leftOffset = btnRect.left - containerRect.left - 6;
                tabIndicator.style.transform = `translateX(${leftOffset}px)`;
                currentTab = tabName;
                if (navigator.vibrate) navigator.vibrate([50, 30, 100]);
            }

            setTimeout(() => switchTab('feedback'), 100);
            tabButtons.forEach(btn => btn.addEventListener('click', () => switchTab(btn.dataset.tab)));

            function toggleConsent() {
                consentGiven = !consentGiven;
                consentCheckbox.classList.toggle('checked', consentGiven);
                consentCheckbox.setAttribute('aria-checked', consentGiven);
                consentInput.checked = consentGiven;
                if (navigator.vibrate) navigator.vibrate(50);
                validateRegistrationForm();
            }

            window.toggleConsent = toggleConsent;

            function validateRegistrationForm() {
                const fields = {
                    firstName: document.getElementById('firstName').value.trim(),
                    lastName: document.getElementById('lastName').value.trim(),
                    maritalStatus: document.getElementById('maritalStatus').value,
                    phone: document.getElementById('phone').value.trim(),
                    dateOfBirth: document.getElementById('dateOfBirth').value,
                    gender: document.getElementById('gender').value,
                    address: document.getElementById('address').value.trim(),
                    payor: payorSelect.value,
                    hmoId: hmoIdInput.value.trim()
                };

                const hmoOptions = ['aiico', 'anchor', 'axamansard', 'bastion', 'clearline', 'hygeia', 'leadway', 'nem', 'phillips', 'reliance', 'tht'];
                const hmoIdValid = !hmoOptions.includes(fields.payor) || (hmoOptions.includes(fields.payor) && fields.hmoId);

                const isValid = Object.values(fields).every(field => field || field === fields.hmoId) && consentGiven && hmoIdValid;
                registerBtn.disabled = !isValid;

                ['firstName', 'lastName', 'maritalStatus', 'phone', 'dateOfBirth', 'gender', 'address', 'payor', 'hmoId'].forEach(id => {
                    const element = document.getElementById(id);
                    const errorElement = document.getElementById(`${id}Error`);
                    if (element && errorElement) {
                        const isError = !element.value.trim() && element.required;
                        element.classList.toggle('error', isError);
                        errorElement.style.display = isError ? 'block' : 'none';
                    }
                });
            }

            function validateContact() {
                const contact = document.getElementById('patientContact').value.trim();
                const errorElement = document.getElementById('patientContactError');
                if (!contact) return true;
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                const phoneRegex = /^\+?\d{10,14}$/;
                const isValid = emailRegex.test(contact) || phoneRegex.test(contact);
                errorElement.style.display = isValid ? 'none' : 'block';
                document.getElementById('patientContact').classList.toggle('error', !isValid);
                return isValid;
            }

            payorSelect.addEventListener('change', () => {
                const selectedPayor = payorSelect.value;
                const hmoOptions = ['aiico', 'anchor', 'axamansard', 'bastion', 'clearline', 'hygeia', 'leadway', 'nem', 'phillips', 'reliance', 'tht'];
                if (hmoOptions.includes(selectedPayor)) {
                    hmoIdInput.disabled = false;
                    hmoIdInput.required = true;
                    hmoIdInput.style.opacity = '1';
                    paymentInfo.classList.remove('show');
                } else {
                    hmoIdInput.disabled = true;
                    hmoIdInput.required = false;
                    hmoIdInput.value = '';
                    hmoIdInput.style.opacity = '0.7';
                    if (selectedPayor === 'personal') {
                        paymentText.innerHTML = 'Please pay <span class="price-highlight">‚Ç¶7,500</span> to <span class="price-highlight">5380820030</span> (Moniepoint) to activate your personal plan! üíö';
                        paymentInfo.classList.add('show');
                    } else if (selectedPayor === 'family') {
                        paymentText.innerHTML = 'Please pay <span class="price-highlight">‚Ç¶15,000</span> to <span class="price-highlight">5380820030</span> (Moniepoint) to activate your family plan! üë®‚Äçüë©‚Äçüëß‚Äçüë¶';
                        paymentInfo.classList.add('show');
                    } else {
                        paymentInfo.classList.remove('show');
                    }
                }
                validateRegistrationForm();
            });

            ['firstName', 'lastName', 'middleName', 'maritalStatus', 'phone', 'dateOfBirth', 'gender', 'address', 'hmoId'].forEach(id => {
                const element = document.getElementById(id);
                if (element) element.addEventListener('input', validateRegistrationForm);
            });

            document.getElementById('patientContact').addEventListener('input', validateContact);

            document.getElementById('phone').addEventListener('input', e => {
                let value = e.target.value.replace(/\D/g, '');
                if (value.startsWith('234')) {
                    value = '+' + value;
                } else if (value.startsWith('0')) {
                    value = '+234' + value.substring(1);
                } else if (value && !value.startsWith('+')) {
                    value = '+234' + value;
                }
                e.target.value = value;
                validateRegistrationForm();
            });

            document.getElementById('dateOfBirth').addEventListener('change', e => {
                const dateInput = e.target;
                if (dateInput.value) {
                    const date = new Date(dateInput.value);
                    const day = String(date.getDate()).padStart(2, '0');
                    const month = String(date.getMonth() + 1).padStart(2, '0');
                    const year = date.getFullYear();
                    dateInput.dataset.formattedValue = `${day}/${month}/${year}`;
                } else {
                    dateInput.dataset.formattedValue = '';
                }
                validateRegistrationForm();
            });

            registrationForm.addEventListener('submit', e => {
                e.preventDefault();
                if (registerBtn.disabled) return;
                const selectedPayor = payorSelect.value;
                const dateOfBirthInput = document.getElementById('dateOfBirth');
                const registrationData = {
                    lastName: document.getElementById('lastName').value.trim(),
                    firstName: document.getElementById('firstName').value.trim(),
                    middleName: document.getElementById('middleName').value.trim() || 'Not provided',
                    maritalStatus: document.getElementById('maritalStatus').value,
                    phone: document.getElementById('phone').value.trim(),
                    email: document.getElementById('email').value.trim() || 'Not provided',
                    dateOfBirth: dateOfBirthInput.dataset.formattedValue || dateOfBirthInput.value,
                    gender: document.getElementById('gender').value,
                    address: document.getElementById('address').value.trim(),
                    payor: selectedPayor,
                    hmoId: document.getElementById('hmoId').value.trim() || 'Not applicable',
                    timestamp: new Date().toISOString(),
                    registrationId: 'REG-' + Date.now()
                };
                registerBtn.innerHTML = '<span style="opacity:0.7">‚ú® Processing...</span>';
                registerBtn.disabled = true;
                sendRegistrationEmail(registrationData);
                updateSuccessMessage(selectedPayor);
                setTimeout(() => {
                    document.getElementById('registrationForm').style.display = 'none';
                    document.getElementById('registrationSuccess').style.display = 'block';
                }, 1000);
            });

            function updateSuccessMessage(payorType) {
                const successMessage = document.getElementById('successMessage');
                let message = "Your registration is complete! We'll be in touch soon! üíö";
                if (payorType === 'personal') {
                    message += " Please pay ‚Ç¶7,500 to 5380820030 (Moniepoint) to activate your account! üéØ";
                } else if (payorType === 'family') {
                    message += " Please pay ‚Ç¶15,000 to 5380820030 (Moniepoint) for your family plan! üë®‚Äçüë©‚Äçüëß‚Äçüë¶";
                }
                successMessage.textContent = message;
            }

            function sendRegistrationEmail(data) {
                const payorDisplay = {
                    personal: 'Personal (‚Ç¶7,500)', family: 'Family (‚Ç¶15,000)', aiico: 'AIICO', anchor: 'Anchor',
                    axamansard: 'Axamansard', bastion: 'Bastion', clearline: 'Clearline', hygeia: 'Hygeia',
                    leadway: 'Leadway', nem: 'NEM', phillips: 'Phillips', reliance: 'Reliance', tht: 'THT'
                };
                const templateParams = {
                    hospital_name: 'Magodo Specialist Hospital',
                    registration_id: data.registrationId,
                    patient_name: `${data.lastName} ${data.firstName}${data.middleName !== 'Not provided' ? ' ' + data.middleName : ''}`,
                    marital_status: data.maritalStatus,
                    phone_number: data.phone,
                    email_address: data.email,
                    date_of_birth: data.dateOfBirth,
                    gender: data.gender,
                    address: data.address,
                    hmo: payorDisplay[data.payor] || data.payor,
                    hmo_id: data.hmoId,
                    registration_timestamp: new Date(data.timestamp).toLocaleString(),
                    priority_level: 'üü° Normal Priority'
                };
                emailjs.send('service_vmknsar', 'template_2f4o2a9', templateParams)
                    .then(response => console.log('Registration email sent!', response.status))
                    .catch(error => console.error('Registration email failed:', error));
            }

            function updateSubmitButton() {
                document.getElementById('submitBtn').disabled = !(satisfactionRating !== null && recommendRating !== null && validateContact());
            }

            document.querySelectorAll('.rating-option').forEach(btn => {
                btn.addEventListener('click', () => {
                    const container = btn.parentElement;
                    const containerType = container.id;
                    container.querySelectorAll('.rating-option').forEach(sibling => {
                        sibling.classList.remove('selected');
                        sibling.setAttribute('aria-checked', 'false');
                    });
                    btn.classList.add('selected');
                    btn.setAttribute('aria-checked', 'true');
                    const value = parseInt(btn.dataset.value);
                    if (containerType === 'satisfactionRating') satisfactionRating = value;
                    else if (containerType === 'recommendRating') recommendRating = value;
                    if (navigator.vibrate) navigator.vibrate([50, 20, 80]);
                    updateSubmitButton();
                });
            });

            document.getElementById('submitBtn').addEventListener('click', () => {
                if (!validateContact()) return;
                const patientName = document.getElementById('patientName').value.trim();
                const patientContact = document.getElementById('patientContact').value.trim();
                const comments = document.getElementById('comments').value;
                const timestamp = new Date().toISOString();
                const feedbackData = {
                    satisfaction: satisfactionRating,
                    recommendation: recommendRating,
                    patientName: patientName || 'Anonymous',
                    patientContact: patientContact || 'Not provided',
                    comments: comments,
                    timestamp: timestamp,
                    userAgent: navigator.userAgent,
                    hospital: 'Magodo Specialist Hospital'
                };
                submitFeedback(feedbackData);
            });

            function submitFeedback(data) {
                const submitBtn = document.getElementById('submitBtn');
                submitBtn.innerHTML = '<span style="opacity:0.7">üöÄ Sending...</span>';
                submitBtn.disabled = true;
                sendFeedbackEmail(data);
                setTimeout(() => {
                    document.getElementById('surveyForm').style.display = 'none';
                    document.getElementById('thankYou').style.display = 'block';
                }, 1000);
            }

            async function analyzeTextFeedback(text) {
                if (!text || text.trim().length === 0) {
                    return { score: 3, sentiment: 'neutral', confidence: 0.5, keywords: [], issues: [], positives: [], aiAnalysis: null };
                }
                const customAnalysis = performCustomAnalysis(text);
                try {
                    const aiAnalysis = await getHuggingFaceSentiment(text);
                    const combinedScore = (customAnalysis.score * 0.6) + (aiAnalysis.score * 0.4);
                    return {
                        score: Math.round(combinedScore * 10) / 10,
                        sentiment: aiAnalysis.sentiment,
                        confidence: aiAnalysis.confidence,
                        keywords: customAnalysis.keywords,
                        issues: customAnalysis.issues,
                        positives: customAnalysis.positives,
                        aiAnalysis: aiAnalysis
                    };
                } catch (error) {
                    console.error('AI analysis failed:', error);
                    return customAnalysis;
                }
            }

            async function getHuggingFaceSentiment(text) {
                try {
                    const response = await fetch(
                        "https://api-inference.huggingface.co/models/cardiffnlp/twitter-roberta-base-sentiment-latest",
                        {
                            headers: { "Content-Type": "application/json" }, // Add Authorization header if needed
                            method: "POST",
                            body: JSON.stringify({ inputs: text })
                        }
                    );
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    const result = await response.json();
                    const scores = Array.isArray(result) ? result[0] : result;
                    let maxScore = 0;
                    let predictedSentiment = 'neutral';
                    if (scores && Array.isArray(scores)) {
                        scores.forEach(item => {
                            if (item.score > maxScore) {
                                maxScore = item.score;
                                predictedSentiment = item.label.toLowerCase().includes('positive') ? 'positive' :
                                                    item.label.toLowerCase().includes('negative') ? 'negative' : 'neutral';
                            }
                        });
                    }
                    let sentimentScore = 3;
                    if (predictedSentiment === 'positive') sentimentScore = 4 + (maxScore * 1);
                    else if (predictedSentiment === 'negative') sentimentScore = 2 - (maxScore * 1);
                    return {
                        sentiment: predictedSentiment,
                        confidence: Math.max(maxScore, 0.5),
                        score: Math.max(1, Math.min(5, sentimentScore)),
                        rawResponse: scores
                    };
                } catch (error) {
                    console.error('Hugging Face API error:', error);
                    return { sentiment: 'neutral', confidence: 0.5, score: 3, rawResponse: null };
                }
            }

            function performCustomAnalysis(text) {
                const lowerText = text.toLowerCase();
                const positiveWords = {
                    excellent: 5, outstanding: 5, exceptional: 5, amazing: 5, perfect: 5,
                    wonderful: 4, fantastic: 4, great: 4, awesome: 4, professional: 4,
                    caring: 4, helpful: 4, friendly: 4, efficient: 4, clean: 4,
                    good: 3, nice: 3, pleasant: 3, adequate: 3, okay: 2
                };
                const negativeWords = {
                    terrible: 1, awful: 1, horrible: 1, worst: 1, disgusting: 1,
                    coerced: 1, empathy: 1, bad: 2, poor: 2, disappointing: 2,
                    frustrated: 2, slow: 2, expensive: 2, confusing: 2, uncomfortable: 2, rude: 1
                };
                let totalScore = 0, wordCount = 0, foundKeywords = [], issues = [], positives = [];
                Object.keys(positiveWords).forEach(word => {
                    if (lowerText.includes(word)) {
                        totalScore += positiveWords[word];
                        wordCount++;
                        foundKeywords.push(word);
                        positives.push(word);
                    }
                });
                Object.keys(negativeWords).forEach(word => {
                    if (lowerText.includes(word)) {
                        totalScore += negativeWords[word];
                        wordCount++;
                        foundKeywords.push(word);
                        if (negativeWords[word] <= 2) issues.push(word);
                    }
                });
                let finalScore = wordCount === 0 ? 3 : totalScore / wordCount;
                finalScore = Math.max(1, Math.min(5, finalScore));
                return {
                    score: Math.round(finalScore * 10) / 10,
                    sentiment: finalScore >= 4 ? 'positive' : finalScore <= 2 ? 'negative' : 'neutral',
                    confidence: Math.min(wordCount / 10, 1),
                    keywords: foundKeywords,
                    issues: issues,
                    positives: positives
                };
            }

            function sendFeedbackEmail(data) {
                const satisfactionLabels = ['', 'Very Poor', 'Poor', 'Fair', 'Good', 'Excellent'];
                const recommendLabels = ['', 'Never', 'Unlikely', 'Maybe', 'Likely', 'Definitely'];
                analyzeTextFeedback(data.comments).then(textAnalysis => {
                    const overallScore = ((data.satisfaction * 0.4) + (data.recommendation * 0.4) + (textAnalysis.score * 0.2)).toFixed(1);
                    let priority = 'Normal', priorityEmoji = 'üü°';
                    if (overallScore <= 2.5) { priority = 'High - Needs Attention'; priorityEmoji = 'üî¥'; }
                    else if (overallScore >= 4.5) { priority = 'Low - Very Satisfied'; priorityEmoji = 'üü¢'; }
                    const templateParams = {
                        hospital_name: 'Magodo Specialist Hospital',
                        patient_name: data.patientName,
                        patient_contact: data.patientContact,
                        satisfaction_rating: `${satisfactionLabels[data.satisfaction]} (${data.satisfaction}/5)`,
                        recommendation_score: `${recommendLabels[data.recommendation]} (${data.recommendation}/5)`,
                        comments: data.comments || 'No comments provided',
                        timestamp: new Date(data.timestamp).toLocaleString(),
                        overall_score: `${overallScore}/5.0`,
                        priority_level: `${priority} ${priorityEmoji}`,
                        sentiment: textAnalysis.sentiment.charAt(0).toUpperCase() + textAnalysis.sentiment.slice(1),
                        ai_confidence: `${(textAnalysis.confidence * 100).toFixed(1)}%`,
                        ai_score: `${textAnalysis.score}/5`,
                        issues_found: textAnalysis.issues.length > 0 ? textAnalysis.issues.join(', ') : 'None',
                        positives_found: textAnalysis.positives.length > 0 ? textAnalysis.positives.join(', ') : 'None'
                    };
                    emailjs.send('service_vmknsar', 'template_2wpah22', templateParams)
                        .then(response => console.log('Feedback email sent!', response.status))
                        .catch(error => console.error('Feedback email failed:', error));
                }).catch(error => {
                    console.error('Analysis failed:', error);
                    const templateParams = {
                        hospital_name: 'Magodo Specialist Hospital',
                        patient_name: data.patientName,
                        patient_contact: data.patientContact,
                        satisfaction_rating: `${satisfactionLabels[data.satisfaction]} (${data.satisfaction}/5)`,
                        recommendation_score: `${recommendLabels[data.recommendation]} (${data.recommendation}/5)`,
                        comments: data.comments || 'No comments provided',
                        timestamp: new Date(data.timestamp).toLocaleString()
                    };
                    emailjs.send('service_vmknsar', 'template_2wpah22', templateParams)
                        .then(response => console.log('Fallback feedback email sent!', response.status))
                        .catch(error => console.error('Feedback email failed:', error));
                });
            }
        });
    </script>
</body>
</html>
